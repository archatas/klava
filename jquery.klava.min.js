/*
 * jquery.klava.js
 * Keyboard layout simulator
 *
 * Demo: http://aaiddennium.com/tools/klava_v2.0/
 * Repo: https://github.com/archatas/klava
 * 
 * Copyright (c) 2013 Aidas Bendoraitis aka archatas
 * Licensed under a Creative Commons Attribution 3.0 Unported License.
 */
(function(e,t){var n={};e.fn.klava=function(t){function h(t){var r=o.length;e(o).each(function(){var i=this;if(!n[i]){e.getScript(i,function(e,s,o){if(s=="success"){n[i]={};n[i].caption=strLayoutCaption;n[i].translate=arrTranslation;r--;if(!r){t()}}})}else{r--;if(!r){t()}}})}function p(){var t='<div class="keyboardLayoutContainer"><label>'+s.str_keyboard_layout+': <select class="keyboardLayout">';e(o).each(function(){t+='<option value="'+this+'">'+n[this].caption+"</option>"});t+="</select></label></div>";return t}function d(e,t){var n=e;n.focus();if(typeof document.selection!="undefined"){var r=document.selection.createRange();r.text=t;r.collapse(false);r.select()}else if(typeof n.selectionStart!="undefined"){var i=n.selectionStart;var s=n.selectionEnd;var o=n.value.substring(i,s);n.value=n.value.substr(0,i)+t+n.value.substr(s);var u=i+t.length;n.selectionStart=u;n.selectionEnd=u}return false}function v(e){var t=e;t.focus();if(typeof document.selection!="undefined"){var n=document.selection.createRange();if(!n.text){n.moveStart("character",-1)}n.text=""}else if(typeof t.selectionStart!="undefined"){var r=t.selectionStart;var i=t.selectionEnd;var s=t.value.substring(r,i);if(!s.length){r--}t.value=t.value.substr(0,r)+t.value.substr(i);var o=r;t.selectionStart=o;t.selectionEnd=o}return false}function m(e){var t=false;if(e.charCode>8e3||e.keyCode>8e3||c[e.keyCode]&&!document.all||e.ctrlKey||e.metaKey){t=true}return t}function g(t){var n=t.target;var r=e(n).data("objEventSimulator");var i="";if(t.ctrlKey){i+="Ctrl + "}if(r.altKey){i+="Alt + "}if(r.shiftKey&&!r.capsLockKey||!r.shiftKey&&r.capsLockKey){i+="Shift + "}if(t.metaKey){i+="Meta + "}i+=t.keyCode;return i}function y(t){var r;var i=t.target;var s=e(i).data("objEventSimulator");var o=e(i).parent();var u=e(".keyboardLayout",o).val();switch(t.keyCode){case 16:s.shiftKey=true;e(".shiftKey",o).css("fontWeight",s.shiftKey?"bold":"normal");e(".shiftGrKey",o).css("fontWeight",s.shiftKey?"bold":"normal");break;case 17:s.ctrlKey=true;e(".ctrlKey",o).css("fontWeight",s.ctrlKey?"bold":"normal");e(".ctrlGrKey",o).css("fontWeight",s.ctrlKey?"bold":"normal");break;case 18:s.altKey=true;e(".altKey",o).css("fontWeight",s.altKey?"bold":"normal");e(".altGrKey",o).css("fontWeight",s.altKey?"bold":"normal");break;case 20:s.capsLockKey=!s.capsLockKey;e(".capsLockKey",o).css("fontWeight",s.capsLockKey?"bold":"normal");break;case 224:s.metaKey=true;break;default:r=g(t);if(n[u].translate[r]){d(i,n[u].translate[r])}}b(i);if(!r||!n[u].translate[r]){return true}return false}function b(t){var r=e(t).data("objEventSimulator");var s=e(t).parent();var o=e(".keyboardLayout",s).val();if(n[o]){var u=f.length;for(i=0;i<u;i++){var a=e(".alphaNumeric_"+f[i],s);if(a.length){r.keyCode=f[i];var c=g(r);var h=n[o].translate[c];if(h){h=h.replace(/&/,"&");h=h.replace(/</,"<");a.html(h)}else{a.html(" ")}var p=" ";var d=l.length;for(j=0;j<d;j++){c=l[j]+r.keyCode;if(n[o].translate[c]){p+="["+n[o].translate[c]+"] "}}a.attr("title",p)}}}}function w(t,n,r){var i=e(t).data("objEventSimulator");var s=e(t).parent();switch(r){case 16:i.shiftKey=!i.shiftKey;e(".shiftKey",s).css("fontWeight",i.shiftKey?"bold":"normal");e(".shiftGrKey",s).css("fontWeight",i.shiftKey?"bold":"normal");break;case 17:i.ctrlKey=!i.ctrlKey;e(".ctrlKey",s).css("fontWeight",i.ctrlKey?"bold":"normal");e(".ctrlGrKey",s).css("fontWeight",i.ctrlKey?"bold":"normal");break;case 20:i.capsLockKey=!i.capsLockKey;e(".capsLockKey",s).css("fontWeight",i.capsLockKey?"bold":"normal");break;case 18:if(e(n).hasClass("altGrKey")){i.altKey=i.altGrKey=!i.altGrKey;e(".altGrKey",s).css("fontWeight",i.altGrKey?"bold":"normal")}if(e(n).hasClass("altKey")){i.altKey=!i.altKey;e(".altKey",s).css("fontWeight",i.altKey?"bold":"normal")}break;default:i.keyCode=r;i.target=t;y(i);i.shiftKey=false;e(".shiftKey",s).css("fontWeight",i.shiftKey?"bold":"normal");e(".shiftGrKey",s).css("fontWeight",i.shiftKey?"bold":"normal")}b(t)}function E(t){var n=t.target;var r=e(n).data("objEventSimulator");var i=e(n).parent();switch(t.keyCode){case 16:r.shiftKey=false;e(".shiftKey",i).css("fontWeight",r.shiftKey?"bold":"normal");e(".shiftGrKey",i).css("fontWeight",r.shiftKey?"bold":"normal");break;case 17:r.ctrlKey=false;e(".ctrlKey",i).css("fontWeight",r.ctrlKey?"bold":"normal");e(".ctrlGrKey",i).css("fontWeight",r.ctrlKey?"bold":"normal");break;case 18:r.altKey=false;e(".altKey",i).css("fontWeight",r.altKey?"bold":"normal");e(".altGrKey",i).css("fontWeight",r.altKey?"bold":"normal");break;case 20:break;case 224:r.metaKey=false;break}b(n);t.cancelBubble=true;return false}var r=this;var s=e.extend({expanded:false,str_keyboard_layout:"Keyboard layout",layouts:["layouts/kbd-us.js","layouts/kbd-baltic.js","layouts/kbd-rusphon.js","layouts/kbd-de.js"]},t);var o=s.layouts;var u='<div class="keyboardContainer"><div class="keyboard">'+'<div class="keyboardRow"><button data-keycode="192" class="alphaNumeric_192">~</button><button data-keycode="49" class="alphaNumeric_49">!</button><button data-keycode="50" class="alphaNumeric_50">@</button><button data-keycode="51" class="alphaNumeric_51">#</button><button data-keycode="52" class="alphaNumeric_52">$</button><button data-keycode="53" class="alphaNumeric_53">%</button><button data-keycode="54" class="alphaNumeric_54" class="alphaNumeric_54">^</button><button data-keycode="55" class="alphaNumeric_55">&</button><button data-keycode="56" class="alphaNumeric_56">*</button><button data-keycode="57" class="alphaNumeric_57">(</button><button data-keycode="48" class="alphaNumeric_48">)</button><button data-keycode="189" class="alphaNumeric_189">_</button><button data-keycode="187" class="alphaNumeric_187">+</button><button class="backSpace">Back</button></div>'+'<div class="keyboardRow"><button data-keycode="9" class="tab">Tab</button><button data-keycode="81" class="alphaNumeric_81">Q</button><button data-keycode="87" class="alphaNumeric_87">W</button><button data-keycode="69" class="alphaNumeric_69">E</button><button data-keycode="82" class="alphaNumeric_82">R</button><button data-keycode="84" class="alphaNumeric_84">T</button><button data-keycode="89" class="alphaNumeric_89">Y</button><button data-keycode="85" class="alphaNumeric_85">U</button><button data-keycode="73" class="alphaNumeric_73">I</button><button data-keycode="79" class="alphaNumeric_79">O</button><button data-keycode="80" class="alphaNumeric_80">P</button><button data-keycode="219" class="alphaNumeric_219">[</button><button data-keycode="221" class="alphaNumeric_221">]</button><button data-keycode="220" class="pipeAndBackSlash" class="alphaNumeric_220">|</button></div>'+'<div class="keyboardRow"><button data-keycode="20" class="capsLockKey capsLock">Caps</button><button data-keycode="65" class="alphaNumeric_65">A</button><button data-keycode="83" class="alphaNumeric_83">S</button><button data-keycode="68" class="alphaNumeric_68">D</button><button data-keycode="70" class="alphaNumeric_70">F</button><button data-keycode="71" class="alphaNumeric_71">G</button><button data-keycode="72" class="alphaNumeric_72">H</button><button data-keycode="74" class="alphaNumeric_74">J</button><button data-keycode="75" class="alphaNumeric_75">K</button><button data-keycode="76" class="alphaNumeric_76">L</button><button data-keycode="186" class="alphaNumeric_186">;</button><button data-keycode="222" class="alphaNumeric_222">\'</button><button data-keycode="13" class="enter">Enter</button></div>'+'<div class="keyboardRow"><button class="shiftKey shift" data-keycode="16">Shift</button><button data-keycode="90" class="alphaNumeric_90">Z</button><button data-keycode="88" class="alphaNumeric_88">X</button><button data-keycode="67" class="alphaNumeric_67">C</button><button data-keycode="86" class="alphaNumeric_86">V</button><button data-keycode="66" class="alphaNumeric_66">B</button><button data-keycode="78" class="alphaNumeric_78">N</button><button data-keycode="77" class="alphaNumeric_77">M</button><button data-keycode="188" class="alphaNumeric_188">,</button><button data-keycode="190" class="alphaNumeric_190">.</button><button data-keycode="191" class="alphaNumeric_191">/</button><button data-keycode="16" class="shiftGrKey shiftGr">Shift</button></div>'+'<div class="keyboardRow"><button data-keycode="17" class="ctrlKey ctrl" disabled="disabled">Ctrl</button><button data-keycode="18" class="altKey alt">Alt</button><button data-keycode="32" class="space">Space</button><button data-keycode="18" class="altGrKey altGr">Alt</button><button data-keycode="17" class="ctrlGrKey ctrlGr" disabled="disabled">Ctrl</button></div>'+"</div></div>";var a='<div class="keyboardHandle"><a href="#">â–¼</a></div>';var f=[192,49,50,51,52,53,54,55,56,57,48,189,187,81,87,69,82,84,89,85,73,79,80,219,221,220,65,83,68,70,71,72,74,75,76,186,222,90,88,67,86,66,78,77,188,190,191];var l=["","Shift + ","Alt + ","Alt + Shift + "];var c=[];c[8]="Backspace";c[27]="Esc";c[33]="Page Up";c[34]="Page Down";c[35]="End";c[36]="Home";c[37]="Left";c[38]="Top";c[39]="Right";c[40]="Bottom";c[45]="Insert";c[46]="Delete";for(i=1;i<=12;i++){c[111+i]="F"+i}c[18]="Alt";for(i=0;i<=10;i++){c[96+i]=""+i}c[144]="Num Lock";c[145]="Scroll Lock";h(function(){r.each(function(){var t=this;var n=e(this).parent();var r={capsLockKey:false,ctrlKey:false,altKey:false,altGrKey:false,shiftKey:false,keyCode:0,target:t};e(t).data("objEventSimulator",r);n.append(p()).append(u).append(a);e(".keyboardLayout",n).change(function(){return b(t)}).change();e("button:not(.backSpace)",n).click(function(){return w(t,this,e(this).data("keycode"))});e("button.backSpace",n).click(function(){return v(t)});var i=e(".keyboardHandle a",n).click(function(){var t=e(".keyboardContainer",n);if(t.is(":visible")){t.slideUp();e(this).html("â–¼")}else{t.slideDown();e(this).html("â–²")}return false}).each(function(){if(s.expanded){var t=e(".keyboardContainer",n);t.show();e(this).html("â–²")}});e(this).keypress(m).keydown(y).keyup(E)})});return r}})(jQuery)
