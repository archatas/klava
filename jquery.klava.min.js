/*
 * jquery.klava.js
 * Keyboard layout simulator
 *
 * Demo: http://aaiddennium.com/tools/klava_v2.0/
 * Repo: https://github.com/archatas/klava
 * 
 * Copyright (c) 2013 Aidas Bendoraitis aka archatas
 * Licensed under a Creative Commons Attribution 3.0 Unported License.
 */
(function(a,c){var b={};a.fn.klava=function(g){var l=this;var w=a.extend({expanded:false,str_keyboard_layout:"Keyboard layout",layouts:["layouts/kbd-us.js","layouts/kbd-baltic.js","layouts/kbd-rusphon.js","layouts/kbd-de.js"]},g);var d=w.layouts;var k='<div class="keyboardContainer"><div class="keyboard"><div class="keyboardRow"><button data-keycode="192" class="alphaNumeric_192">~</button><button data-keycode="49" class="alphaNumeric_49">!</button><button data-keycode="50" class="alphaNumeric_50">@</button><button data-keycode="51" class="alphaNumeric_51">#</button><button data-keycode="52" class="alphaNumeric_52">$</button><button data-keycode="53" class="alphaNumeric_53">%</button><button data-keycode="54" class="alphaNumeric_54" class="alphaNumeric_54">^</button><button data-keycode="55" class="alphaNumeric_55">&amp;</button><button data-keycode="56" class="alphaNumeric_56">*</button><button data-keycode="57" class="alphaNumeric_57">(</button><button data-keycode="48" class="alphaNumeric_48">)</button><button data-keycode="189" class="alphaNumeric_189">_</button><button data-keycode="187" class="alphaNumeric_187">+</button><button class="backSpace">Back</button></div><div class="keyboardRow"><button data-keycode="9" class="tab">Tab</button><button data-keycode="81" class="alphaNumeric_81">Q</button><button data-keycode="87" class="alphaNumeric_87">W</button><button data-keycode="69" class="alphaNumeric_69">E</button><button data-keycode="82" class="alphaNumeric_82">R</button><button data-keycode="84" class="alphaNumeric_84">T</button><button data-keycode="89" class="alphaNumeric_89">Y</button><button data-keycode="85" class="alphaNumeric_85">U</button><button data-keycode="73" class="alphaNumeric_73">I</button><button data-keycode="79" class="alphaNumeric_79">O</button><button data-keycode="80" class="alphaNumeric_80">P</button><button data-keycode="219" class="alphaNumeric_219">[</button><button data-keycode="221" class="alphaNumeric_221">]</button><button data-keycode="220" class="pipeAndBackSlash" class="alphaNumeric_220">|</button></div><div class="keyboardRow"><button data-keycode="20" class="capsLockKey capsLock">Caps</button><button data-keycode="65" class="alphaNumeric_65">A</button><button data-keycode="83" class="alphaNumeric_83">S</button><button data-keycode="68" class="alphaNumeric_68">D</button><button data-keycode="70" class="alphaNumeric_70">F</button><button data-keycode="71" class="alphaNumeric_71">G</button><button data-keycode="72" class="alphaNumeric_72">H</button><button data-keycode="74" class="alphaNumeric_74">J</button><button data-keycode="75" class="alphaNumeric_75">K</button><button data-keycode="76" class="alphaNumeric_76">L</button><button data-keycode="186" class="alphaNumeric_186">;</button><button data-keycode="222" class="alphaNumeric_222">\'</button><button data-keycode="13" class="enter">Enter</button></div><div class="keyboardRow"><button class="shiftKey shift" data-keycode="16">Shift</button><button data-keycode="90" class="alphaNumeric_90">Z</button><button data-keycode="88" class="alphaNumeric_88">X</button><button data-keycode="67" class="alphaNumeric_67">C</button><button data-keycode="86" class="alphaNumeric_86">V</button><button data-keycode="66" class="alphaNumeric_66">B</button><button data-keycode="78" class="alphaNumeric_78">N</button><button data-keycode="77" class="alphaNumeric_77">M</button><button data-keycode="188" class="alphaNumeric_188">,</button><button data-keycode="190" class="alphaNumeric_190">.</button><button data-keycode="191" class="alphaNumeric_191">/</button><button data-keycode="16" class="shiftGrKey shiftGr">Shift</button></div><div class="keyboardRow"><button data-keycode="17" class="ctrlKey ctrl" disabled="disabled">Ctrl</button><button data-keycode="18" class="altKey alt">Alt</button><button data-keycode="32" class="space">Space</button><button data-keycode="18" class="altGrKey altGr">Alt</button><button data-keycode="17" class="ctrlGrKey ctrlGr" disabled="disabled">Ctrl</button></div></div></div>';var h='<div class="keyboardHandle"><a href="#">▼</a></div>';var q=[192,49,50,51,52,53,54,55,56,57,48,189,187,81,87,69,82,84,89,85,73,79,80,219,221,220,65,83,68,70,71,72,74,75,76,186,222,90,88,67,86,66,78,77,188,190,191];var v=["","Shift + ","Alt + ","Alt + Shift + "];var f=[];f[8]="Backspace";f[27]="Esc";f[33]="Page Up";f[34]="Page Down";f[35]="End";f[36]="Home";f[37]="Left";f[38]="Top";f[39]="Right";f[40]="Bottom";f[45]="Insert";f[46]="Delete";for(i=1;i<=12;i++){f[111+i]="F"+i}f[18]="Alt";for(i=0;i<=10;i++){f[96+i]=""+i}f[144]="Num Lock";f[145]="Scroll Lock";function s(z){var y=d.length;a(d).each(function(){var A=this;if(!b[A]){a.getScript(A,function(B,D,C){if(D=="success"){b[A]={};b[A].caption=strLayoutCaption;b[A].translate=arrTranslation;y--;if(!y){z()}}})}else{y--;if(!y){z()}}})}function u(){var y='<div class="keyboardLayoutContainer"><label>'+w.str_keyboard_layout+': <select class="keyboardLayout">';a(d).each(function(){y+='<option value="'+this+'">'+b[this].caption+"</option>"});y+="</select></label></div>";return y}function e(z,C){var y=z;y.focus();if(typeof document.selection!="undefined"){var E=document.selection.createRange();E.text=C;E.collapse(false);E.select()}else{if(typeof y.selectionStart!="undefined"){var F=y.selectionStart;var D=y.selectionEnd;var A=y.value.substring(F,D);y.value=y.value.substr(0,F)+C+y.value.substr(D);var B=F+C.length;y.selectionStart=B;y.selectionEnd=B}}return false}function p(z){var y=z;y.focus();if(typeof document.selection!="undefined"){var D=document.selection.createRange();if(!D.text){D.moveStart("character",-1)}D.text=""}else{if(typeof y.selectionStart!="undefined"){var E=y.selectionStart;var C=y.selectionEnd;var A=y.value.substring(E,C);if(!A.length){E--}y.value=y.value.substr(0,E)+y.value.substr(C);var B=E;y.selectionStart=B;y.selectionEnd=B}}return false}function n(y){var z=false;if(y.charCode>8000||y.keyCode>8000||(f[y.keyCode]&&!document.all)||y.ctrlKey||y.metaKey){z=true}return z}function m(y){var z=y.target;var A=a(z).data("objEventSimulator");var B="";if(y.ctrlKey){B+="Ctrl + "}if(A.altKey){B+="Alt + "}if((A.shiftKey&&!A.capsLockKey)||(!A.shiftKey&&A.capsLockKey)){B+="Shift + "}if(y.metaKey){B+="Meta + "}B+=y.keyCode;return B}function t(y){var D;var z=y.target;var A=a(z).data("objEventSimulator");var C=a(z).parent();var B=a(".keyboardLayout",C).val();switch(y.keyCode){case 16:A.shiftKey=true;a(".shiftKey",C).css("fontWeight",(A.shiftKey)?"bold":"normal");a(".shiftGrKey",C).css("fontWeight",(A.shiftKey)?"bold":"normal");break;case 17:A.ctrlKey=true;a(".ctrlKey",C).css("fontWeight",(A.ctrlKey)?"bold":"normal");a(".ctrlGrKey",C).css("fontWeight",(A.ctrlKey)?"bold":"normal");break;case 18:A.altKey=true;a(".altKey",C).css("fontWeight",(A.altKey)?"bold":"normal");a(".altGrKey",C).css("fontWeight",(A.altKey)?"bold":"normal");break;case 20:A.capsLockKey=!A.capsLockKey;a(".capsLockKey",C).css("fontWeight",(A.capsLockKey)?"bold":"normal");break;case 224:A.metaKey=true;break;default:D=m(y);if(b[B].translate[D]){e(z,b[B].translate[D])}}o(z);if(!D||!(b[B].translate[D])){return true}return false}function o(E){var D=a(E).data("objEventSimulator");var C=a(E).parent();var F=a(".keyboardLayout",C).val();if(b[F]){var H=q.length;for(i=0;i<H;i++){var B=a(".alphaNumeric_"+q[i],C);if(B.length){D.keyCode=q[i];var y=m(D);var z=b[F].translate[y];if(z){z=z.replace(/&/,"&amp;");z=z.replace(/</,"&lt;");B.html(z)}else{B.html("&nbsp;")}var G=" ";var A=v.length;for(j=0;j<A;j++){y=v[j]+D.keyCode;if(b[F].translate[y]){G+="["+b[F].translate[y]+"] "}}B.attr("title",G)}}}}function x(z,y,B){var A=a(z).data("objEventSimulator");var C=a(z).parent();switch(B){case 16:A.shiftKey=!A.shiftKey;a(".shiftKey",C).css("fontWeight",(A.shiftKey)?"bold":"normal");a(".shiftGrKey",C).css("fontWeight",(A.shiftKey)?"bold":"normal");break;case 17:A.ctrlKey=!A.ctrlKey;a(".ctrlKey",C).css("fontWeight",(A.ctrlKey)?"bold":"normal");a(".ctrlGrKey",C).css("fontWeight",(A.ctrlKey)?"bold":"normal");break;case 20:A.capsLockKey=!A.capsLockKey;a(".capsLockKey",C).css("fontWeight",(A.capsLockKey)?"bold":"normal");break;case 18:if(a(y).hasClass("altGrKey")){A.altKey=A.altGrKey=!A.altGrKey;a(".altGrKey",C).css("fontWeight",(A.altGrKey)?"bold":"normal")}if(a(y).hasClass("altKey")){A.altKey=!A.altKey;a(".altKey",C).css("fontWeight",(A.altKey)?"bold":"normal")}break;default:A.keyCode=B;A.target=z;t(A);A.shiftKey=false;a(".shiftKey",C).css("fontWeight",(A.shiftKey)?"bold":"normal");a(".shiftGrKey",C).css("fontWeight",(A.shiftKey)?"bold":"normal")}o(z)}function r(y){var z=y.target;var A=a(z).data("objEventSimulator");var B=a(z).parent();switch(y.keyCode){case 16:A.shiftKey=false;a(".shiftKey",B).css("fontWeight",(A.shiftKey)?"bold":"normal");a(".shiftGrKey",B).css("fontWeight",(A.shiftKey)?"bold":"normal");break;case 17:A.ctrlKey=false;a(".ctrlKey",B).css("fontWeight",(A.ctrlKey)?"bold":"normal");a(".ctrlGrKey",B).css("fontWeight",(A.ctrlKey)?"bold":"normal");break;case 18:A.altKey=false;a(".altKey",B).css("fontWeight",(A.altKey)?"bold":"normal");a(".altGrKey",B).css("fontWeight",(A.altKey)?"bold":"normal");break;case 20:break;case 224:A.metaKey=false;break}o(z);y.cancelBubble=true;return false}s(function(){l.each(function(){var A=this;var z=a(this).parent();var y={capsLockKey:false,ctrlKey:false,altKey:false,altGrKey:false,shiftKey:false,keyCode:0,target:A};a(A).data("objEventSimulator",y);z.append(u()).append(k).append(h);a(".keyboardLayout",z).change(function(){return o(A)}).change();a("button:not(.backSpace)",z).click(function(){return x(A,this,a(this).data("keycode"))});a("button.backSpace",z).click(function(){return p(A)});var B=a(".keyboardHandle a",z).click(function(){var C=a(".keyboardContainer",z);if(C.is(":visible")){C.slideUp();a(this).html("▼")}else{C.slideDown();a(this).html("▲")}return false}).each(function(){if(w.expanded){var C=a(".keyboardContainer",z);C.show();a(this).html("▲")}});a(this).keypress(n).keydown(t).keyup(r)})});return l}})(jQuery);
